# 公私鑰驗證功能說明

## 概述
在初始設定頁面（`app/initialSetup.js`）中，當用戶點擊「完成設定」按鈕時，系統會進行嚴格的公私鑰驗證，確保用戶輸入的密鑰對是正確且匹配的。

## 驗證流程

### 1. 公鑰驗證
- **檢查是否為空**：確保公鑰已填寫
- **長度檢查**：Solana 公鑰（Base58 編碼）長度應為 32-44 個字符
- **格式檢查**：確保是有效的 Base58 格式

### 2. 私鑰驗證
- **檢查是否為空**：確保私鑰已填寫
- **Base58 解碼**：嘗試將私鑰從 Base58 格式解碼
- **長度檢查**：Solana 私鑰解碼後應為 64 bytes
- **密鑰對重建**：嘗試從私鑰重建 Keypair 對象

### 3. 配對驗證
- **推導公鑰**：從私鑰推導出對應的公鑰
- **比對檢查**：將推導的公鑰與用戶輸入的公鑰進行比對
- **錯誤提示**：如果不匹配，顯示詳細的錯誤信息

## 錯誤提示

系統會根據不同的錯誤情況，提供清晰的錯誤提示：

| 錯誤類型 | 錯誤提示 |
|---------|---------|
| 公鑰為空 | "請輸入公鑰" |
| 公鑰長度錯誤 | "公鑰長度不正確\n當前長度：X\n正確長度應為 32-44 個字符" |
| 私鑰為空 | "請輸入私鑰" |
| 私鑰格式錯誤 | "私鑰必須是有效的 Base58 編碼格式\n請檢查是否包含無效字符" |
| 私鑰長度錯誤 | "私鑰長度必須為 64 bytes\n當前長度：X bytes" |
| 私鑰無效 | "無法從私鑰生成密鑰對\n請確認私鑰是否正確" |
| 公私鑰不匹配 | 顯示推導的公鑰和輸入的公鑰，並提示用戶檢查 |

## 使用場景

### 自動生成模式
- 系統自動生成密鑰對
- 驗證會自動通過（因為是系統生成的有效密鑰對）

### 手動輸入模式
- 用戶可以輸入自己的公私鑰
- 系統會進行嚴格驗證：
  - 檢查格式是否正確
  - 檢查長度是否正確
  - **最重要：檢查公鑰和私鑰是否配對**

## 防止錯誤的情況

這個驗證機制可以防止以下情況：

1. ✅ 用戶隨意輸入字符
2. ✅ 用戶輸入格式錯誤的密鑰
3. ✅ 用戶輸入不配對的公私鑰
4. ✅ 用戶複製貼上時包含多餘的空格
5. ✅ 用戶輸入長度不正確的密鑰

## 技術實現

```javascript
const validateKeypair = () => {
  // 1. 驗證公鑰格式和長度
  // 2. 驗證私鑰格式（Base58 解碼）
  // 3. 檢查私鑰長度（64 bytes）
  // 4. 從私鑰重建 Keypair
  // 5. 從私鑰推導公鑰
  // 6. 比對推導的公鑰與輸入的公鑰
  // 7. 返回驗證結果
};
```

## 安全性

- 私鑰在輸入時默認隱藏（需點擊「顯示」按鈕才能看到）
- 驗證失敗時不會保存任何數據
- 所有驗證都在客戶端進行，私鑰不會傳送到服務器
- 保存前會再次進行完整驗證

## 測試建議

### 測試有效密鑰對
使用系統自動生成的密鑰對，切換到手動輸入模式，複製貼上，應該驗證通過。

### 測試無效情況
1. 輸入隨意字符作為公鑰或私鑰
2. 輸入配對錯誤的公私鑰
3. 輸入長度不正確的密鑰
4. 在密鑰前後加入空格（系統會自動修剪）

所有這些情況都應該被正確攔截並顯示相應的錯誤提示。
